@model GG_Shop_v3.Models.Product
@using System.Linq
@{
    ViewBag.Title = "Xóa sản phẩm";
    Layout = "~/Views/Shared/_Layout_admin.cshtml";

    var images = Model.Product_Images?.ToList() ?? new List<GG_Shop_v3.Models.Product_Image>();
    var skus = Model.Product_Skus?.ToList() ?? new List<GG_Shop_v3.Models.Product_Sku>();
}

<div class="content-page">
    <div class="container-fluid">
        <div class="card shadow-sm mt-4">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0">Xác nhận xóa sản phẩm</h4>
            </div>
            <div class="card-body">

                <div class="alert alert-warning text-left">
                    <strong>⚠ Thao tác này sẽ xóa vĩnh viễn dữ liệu sản phẩm, các ảnh và biến thể liên quan.</strong>
                </div>

                <!-- Thông tin sản phẩm -->
                <h5 class="mt-3">Thông tin sản phẩm</h5>
                <hr />
                <dl class="row">
                    <dt class="col-sm-3">Tên sản phẩm:</dt>
                    <dd class="col-sm-9">@Model.Title</dd>

                    <dt class="col-sm-3">Danh mục:</dt>
                    <dd class="col-sm-9">@(Model.Category != null ? Model.Category.Name : "-")</dd>

                    <dt class="col-sm-3">Mô tả:</dt>
                    <dd class="col-sm-9">@(string.IsNullOrEmpty(Model.Description) ? "—" : Model.Description)</dd>

                    <dt class="col-sm-3">Trạng thái:</dt>
                    <dd class="col-sm-9">@Model.Status</dd>
                </dl>

                <!-- Ảnh sản phẩm -->
                <h5 class="mt-4">Ảnh sản phẩm</h5>
                <hr />
                @if (images.Any())
                {
                    <div class="d-flex flex-wrap">
                        @foreach (var img in images)
                        {
                            <div class="m-1 position-relative">
                                <img src="@Url.Content(img.Image_Url)" class="img-thumbnail" style="width:120px; height:100px; object-fit:cover;" />
                                @if (img.Is_Main)
                                {
                                    <span class="badge badge-success position-absolute" style="top:4px; left:4px;">Ảnh chính</span>
                                }
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted"><em>Không có ảnh.</em></p>
                }

                <!-- SKU -->
                <h5 class="mt-4">Danh sách sản phẩm</h5>
                <hr />
                @if (!skus.Any())
                {
                    <p class="text-muted"><em>Không có sản phẩm nào.</em></p>
                }
                else
                {
                    <table class="table table-bordered table-sm">
                        <thead>
                            <tr>
                                <th>Mã sản phẩm</th>
                                <th>Màu sắc</th>
                                <th>Kích cỡ</th>
                                <th>Số lượng</th>
                                <th>Giá (VNĐ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var s in skus)
                            {
                                <tr>
                                    <td>@s.Sku</td>
                                    <td>@(string.IsNullOrEmpty(s.Color) ? "-" : s.Color)</td>
                                    <td>@(string.IsNullOrEmpty(s.Size) ? "-" : s.Size)</td>
                                    <td>@s.Quantity</td>
                                    <td>@String.Format("{0:N0} ₫", s.Price)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }

                <!-- Nút xác nhận -->
            <div class="mt-4 text-right">
                @using (Html.BeginForm("Delete", "Products", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger">
                        <i class="ri-delete-bin-6-line mr-1"></i> Xóa sản phẩm
                    </button>
                    @Html.ActionLink("Hủy bỏ", "Index", null, new { @class = "btn btn-secondary ml-2" })
                }
            </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!confirm("Bạn có chắc chắn muốn xóa sản phẩm này?")) {
            e.preventDefault();
        }
    });
    </script>
}
